<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>考試介面</title>
	  <link href = "css/bootstrap.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/carousel.css" rel="stylesheet">
	  <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="js/jquery.min.js"></script>

    <!--10/24Add,王勁詠,alertify新增 -->


    <link href="css/alertify.core.css" rel="stylesheet">
    <link href="css/alertify.default.css" rel="stylesheet">
    <script type="text/javascript" src="js/alertify.min.js"></script>


    <!--10/24Add,王勁詠,alertify新增 -->

	<style>
  /*考試系統標題*/
    #header {
        color: rgba(#eeeeee, 0.36);
        text-align: center;
        padding: 20px;
    }
    #nav {
        line-height: 30px;
        height: 500px;
        width: 800px;
        float: left;
        padding: 20px;
    }
    #section {
        height: 500px;
        width: 350px;
        float: left;
        padding: 20px;
    }
    #footer {
        background-color: black;
        color: white;
        clear: both;
        text-align: center;
        padding: 10px;
    }
	* { margin: 0; padding: 0; box-sizing: border-box; }
      body {font: 13px Helvetica, Arial; }
      #form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
      #form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
      #form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
      #messages { list-style-type: none; margin: 0; padding: 0; }
      #messages li { padding: 5px 10px; }
      #messages li:nth-child(odd) { background: #eee; }
 	img {
     border: 1px solid #373737;
     margin-right: auto;
     display: block;
    }
    </style>
</head>
<body onload="init()">
    <nav class="navbar navbar-inverse navbar-static-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">考試系統</a>
            </div>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li id="tabback" class="tab"><a id="panelUser"></a></li>
                    <li id="tabstart" class="tab"><a id="panelLogout" type="button" onclick="logout()"></a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!--分成3/6/3等分-->
<div id="panelRegister" class="tab-pane panel">
    <div id="header">
        <h1>考試系統</h1>
    </div>
    <div id="nav">
        <h2 class="text-info"><strong>使用說明</strong></h2>
        <h3 class="text-info"><strong>使用者要先登入系統（判斷是否為出題者）</br>選擇考試內容（考場ＯＲ練習）</br>考試開始可選擇跳過ＯＲ做記號在回顧這些不確定之題目</br>考試結束 查看錯誤之題目</br>成績計算</strong></h3>
  </div>
<div id="section">
<div  id="panelLogin" class="site-wrapper">
            <div class="site-wrapper-inner">
                <div class="cover-container">
                    <form class="form-horizontal">
                    <h1> 註冊</h1>
                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">姓名</label>
                            <div class="col-sm-10">
                                <input id="registerUser" type="email" class="form-control" id="inputEmail3" placeholder="Name">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="inputPassword3" class="col-sm-2 control-label">學號</label>
                            <div class="col-sm-10">
                                <input id="registerPassword" type="password" class="form-control" id="inputPassword3" placeholder="Number">
                            </div>
                        </div>
						<div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">(student
							                                                        /teacher)</label>
                            <div class="col-sm-10">
                                <input id="registerJob" type="email" class="form-control" id="inputEmail3" placeholder="Name">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox"> Remember me
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                            <p class="text-center">
                                <button type="button" class="btn btn-default" onclick="register()">註冊</button>
								<button type="button" class="btn btn-default" onclick="returnHome()">返回</button></p>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
  </div>
</div>
<div id="panelHome" class="tab-pane panel">
    <div id="header">
        <h1>考試系統</h1>
    </div>
    <div id="nav">
        <h2 class="text-info"><strong>使用說明</strong></h2>
        <h3 class="text-info"><strong>使用者要先登入系統（判斷是否為出題者）</br>選擇考試內容（考場ＯＲ練習）</br>考試開始可選擇跳過ＯＲ做記號在回顧這些不確定之題目</br>考試結束 查看錯誤之題目</br>成績計算</strong></h3>

</div>
<div id="section">
<div  id="panelLogin" class="site-wrapper">
            <div class="site-wrapper-inner">
                <div class="cover-container">
                    <form class="form-horizontal">
                    <h1> 登入</h1>
                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">姓名</label>
                            <div class="col-sm-10">
                                <input id="loginUser" type="email" class="form-control" id="inputEmail3" placeholder="Name">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="inputPassword3" class="col-sm-2 control-label">學號</label>
                            <div class="col-sm-10">
                                <input id="loginPassword" type="password" class="form-control" id="inputPassword3" placeholder="Number">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox"> Remember me
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                            <p class="text-center">
                                <button type="button" class="btn btn-default" onclick="login()">登入</button>
								<button type="button" class="btn btn-default" onclick="jump()">註冊</button></p>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
  </div>
</div>
<div id="panelEdit" class="tab-pane panel">
<form class="form-horizontal">
<div class="form-group">
          <input type="file" id="filebox" name="filebox" class="filestyle" data-classButton="btn btn-primary" data-input="false" data-classIcon="icon-plus" data-buttonText="自訂考題"/>
</div>
<textarea id="jsonText" class="form-control" rows="23">
  { "exam" : "EnglishTest" , "qaList" :
  [
    {
      "q" : "'hello world' has __ word?",
      "optionA" : "3",
      "optionB" : "5",
      "optionC" : "7",
      "optionD" : "10",
      "corrAns" : "10"
    },
    {
      "q" : "'Handsome boy' has __ word?",
      "optionA" : "15",
      "optionB" : "10",
      "optionC" : "11",
      "optionD" : "12",
      "corrAns" : "11"
    }
  ]
  ,
    "time" : 60000
  }
    </textarea>
  <table style="float:right; line-height: 30px; font-size:13px; padding-right: 5px;">
  <tr>
  <td>
    <button type="button" class="btn btn-default" onclick="toMeg()">出搶答題目</button>
    <button type="button" class="btn btn-primary" onclick="check()">check</button>
	<button type="button" class="btn btn-success" onclick="send()">送出</button>
  </td>
  </tr>
  </table>
 </form>
</div>

<div id="panelList" class="tab-pane panel">
  </div>

<div id="panelResult" class="tab-pane panel">
</div>

<div id="panelHistory" class="tab-pane panel">
</div>

<div id="panelHistoryreport" class="tab-pane panel">
</div>

<div id="panelQuestion" class="tab-pane panel">
</div>

<div id="panelHistoryquestion" class="tab-pane panel">
</div>

<div id="panelMessage" class="tab-pane panel">
	<ul id="messages"></ul>
    <form id="form">
      <input id="m" autocomplete="off" /><button>Send</button>
    </form>
</div>
<!--考試系統  考試頁面-->

<div id="panelExam" class="container panel">
<!--20151108 Add by 王勁詠-->

    <div class="page-header">

        <h2 class="cok-sm-6">開始測驗
          <div id = "clock"></div>
        </h2>



    </div>


    <br/>

	 <p class="lead">
<!--20151108 remove by 王勁詠-->
<!--
    <form action="javascript:pass()" class="lead">
     當提交表單時，表單數據會提交到名為"javascript:pass()" 的頁面：
      <span id="editBody"></span>
     題目
    </form>
-->

      <span id="editBody"></span>
      <!--題目-->

  </p>



    <!--2015/11/03 Add by 王勁詠-->
    <button type="button" class="btn btn-default active" onclick = "option(this)" id = "optionA">A</button>
    <button type="button" class="btn btn-default active" onclick = "option(this)" id = "optionB">B</button>
    <button type="button" class="btn btn-default active" onclick = "option(this)" id = "optionC">C</button>
    <button type="button" class="btn btn-default active" onclick = "option(this)" id = "optionD">D</button>
    </BR>
    <button type="button" class="btn btn-danger"onclick = "ExamOverTime(0)">結束考試</button>
    </BR>
    <button type="button" class="btn btn-success"onclick = "option(this)" id = "previousQuestion">上一題</button>
    <button type="button" class="btn btn-success"onclick = "option(this)" id = "nextQuestion">下一題</button>
    <div class = "col-sm-12">
    </div>
    </BR>
    <!--
    <input type="button" value="送出答案" onclick="pass()" class="btn btn-danger">
    -->
    <!--<textarea id="editBody" class="form-control" style="width:100%; height:60%"></textarea>-->
</div>
    <script>
    /*使用Jquery才有效果,分頁跟上面點選效果*/
	/*
    function switchPanel(name) {
        $(".panel").css("display", "none");
        $("#panel" + name).css("display", "block");
        $(".tab").removeClass("active");
        $("#tab" + name).addClass("active");
    }
    $('.news').hide();  =  $('.news').css('display','none');
    $('.news').show();  =  $('.news').css('display','block');
	*/
	var jsonText = document.getElementById("jsonText");
  var filebox = document.getElementById("filebox");
	function fileboxChange(evt) {
    var reader = new FileReader();
    reader.onload = function(e) {
     jsonText.value = reader.result;
     save();
    };
     filename = evt.target.files[0].name;
     reader.readAsText(evt.target.files[0]);
    }
	filebox.addEventListener('change', fileboxChange, false);
	function switchPanel(name) {
     $('.panel').css( "display", "none");
     $('#'+name).css( "display", "block");
    }
	function jump() {
	registerUser.value = "";
	registerPassword.value = "";
	registerJob.value = "";
	switchPanel('panelRegister');
	}
  function init() {
  switchPanel('panelHome');
  }
	var noteID;
  var qi;
  function exam(examIdx) {
  	 ei = examIdx;
  	 qi=0;
     $('#editBody').empty();
     switchPanel('panelExam');
     //$('#panelExam').append("<p><div id = 'clock'></div></p>");
  	 $('#editBody').append(exams[ei].qaList[qi].q);
     /*2015/11/03 Add by 王勁詠*/
     $('#editBody').append("<p>A:" + exams[ei].qaList[qi].optionA + "</p>");
     $('#editBody').append("<p>B:" + exams[ei].qaList[qi].optionB + "</p>");
     $('#editBody').append("<p>C:" + exams[ei].qaList[qi].optionC+ "</p>");
     $('#editBody').append("<p>D:" + exams[ei].qaList[qi].optionD + "</p>");
     //$('#editBody').append("<p><div id = 'clock'></div></p>");
     //var dbTime = new Date().getTime() + exams[ei].time;
     /*20151108 add by 王勁詠*/
     var dbTime = new Date().getTime() + exams[ei].time;
     ExamOverTime(dbTime)
     /*
     $('#clock').countdown(dbTime)
      .on('update.countdown',function (event) {
        var $this = $(this);
          $this.html(event.strftime('To end: <span>%H:%M:%S</span>'));
      })
      .on('finish.countdown', function(event){
        var $this = $(this);
        switchPanel('panelResult');
        result();
      });
      */
    }
    /*20151108 Add by 王勁詠 考試時間設定*/
    function ExamOverTime(dbTime) {
      //var dbTime = new Date().getTime() + exams[ei].time;
      $('#clock').countdown(dbTime)
       .on('update.countdown',function (event) {
         var $this = $(this);
           $this.html(event.strftime('To end: <span>%H:%M:%S</span>'));
       })
       .on('finish.countdown', function(event){
         var $this = $(this);
         switchPanel('panelResult');
         result();
       });
    }
	var examId;
	var ei;
  /*
	function pass() {
	  exams[ei].qaList[qi].userAnswer =  $('#editTitle').val();
	  qi++;
      if(qi == exams[ei].qaList.length)
      {
        switchPanel('panelResult');
        result();
	  }	else {
	    $('#editBody').html(exams[ei].qaList[qi].q);
      $('#editBody').append("<p>A:" + exams[ei].qaList[qi].optionA + "</p>");
      $('#editBody').append("<p>B:" + exams[ei].qaList[qi].optionB + "</p>");
      $('#editBody').append("<p>C:" + exams[ei].qaList[qi].optionC+ "</p>");
      $('#editBody').append("<p>D:" + exams[ei].qaList[qi].optionD + "</p>");
	  }
	  //editTitle.value = "";
	}
  */
  /*2015/11/03 Add by 王勁詠*/
function option(userValue) {
  //alert(userAns);
  //exams[ei].qaList[qi].userAnswer =  userAns; //創新的欄位
  /*2015/11/08 Add by 王勁詠*/
  //判斷切題 與選項答案
  //var optionA,optionB,optionC,optionD; //Test
  //var selected  = [qaList[qi] :[] ]; //Test
  switch(userValue.id){
    case "optionA":
      exams[ei].qaList[qi].userAnswer = exams[ei].qaList[qi].optionA;
      qi++;
      $("#selectA").css({
        color: '#ebc000'
      });
      break;
    case "optionB":
      exams[ei].qaList[qi].userAnswer = exams[ei].qaList[qi].optionB;
      qi++;
      $("#selectB").css({
        color: '#ebc000'
      });
      break;
    case "optionC":
      exams[ei].qaList[qi].userAnswer = exams[ei].qaList[qi].optionC;
      qi++;
      $("#selectC").css({
        color: '#ebc000'
      });
      break;
    case "optionD":
      exams[ei].qaList[qi].userAnswer = exams[ei].qaList[qi].optionD;
      qi++;
      $("#selectD").css({
        color: '#ebc000'
      });
      break;
    case "previousQuestion":
      if (qi == 0)
      {
        alertify.alert("沒有上一題囉,請按下一題");
      }else {
        qi--;
      }
      break;
    case "nextQuestion":
      if (qi == exams[ei].qaList.length)
      {
        alertify.alert("這是最後一題囉!");
      }else {
        qi++;
      }
      break;
    default:
        qi++;
  }
  /*
  if (userValue.id == "optionA")
  {
    exams[ei].qaList[qi].userAnswer = exams[ei].qaList[qi].optionA;
    qi++;
  }
  else if (userValue.id == "optionB") {
    exams[ei].qaList[qi].userAnswer = exams[ei].qaList[qi].optionB;
    qi++;
  }
  else if (userValue.id == "optionC") {
    exams[ei].qaList[qi].userAnswer = exams[ei].qaList[qi].optionC;
    qi++;
  }
  else if (userValue.id == "optionD"){
    exams[ei].qaList[qi].userAnswer = exams[ei].qaList[qi].optionD;
    qi++;
  //判斷切題
  }else if(userValue.id == "previousQuestion")
  {
    if (qi == 0)
    {
      alertify.alert("沒有上一題囉,請按下一題");
    }else {
      qi--;
    }
  }
  else if (userValue.id = "nextQuestion") {
    if (qi == exams[ei].qaList.length)
    {
      alertify.alert("這是最後一題囉!");
    }else {
      qi++;
    }
  }
  else{
    //沒有點上一題跟下一題的結果,正常照舊
    qi++;
  }
  */
  if (qi == exams[ei].qaList.length)
  {
    //0 1 2 3 最後一次點選項也會加到,所以qi要扣1
    qi--;
    alertify.set({ buttonReverse: true });
    alertify.confirm("你已經答題完畢,需要繼續作答嗎?",function (e) {
      if(e){
        //Yes
      }else{
        //No
        ExamOverTime(0);
        switchPanel('panelResult');
        result();
      }
    });
    /*
    $('#clock').countdown(0)
     .on('finish.countdown', function(event){
       var $this = $(this);
       switchPanel('panelResult');
       result();
     });
     */
  }else{
    $('#editBody').html(exams[ei].qaList[qi].q);
    /*2015/11/03 Add by 王勁詠*/
    $('#editBody').append("<p>A:" + exams[ei].qaList[qi].optionA + "</p>");
    $('#editBody').append("<p>B:" + exams[ei].qaList[qi].optionB + "</p>");
    $('#editBody').append("<p>C:" + exams[ei].qaList[qi].optionC+ "</p>");
    $('#editBody').append("<p>D:" + exams[ei].qaList[qi].optionD + "</p>");
    $('#editBody').append("<p><div id = 'clock'></div></p>");
  }
}
	var exams; // 考場:包含考試名稱與試題內容
	var userExam = { answer:[] }; // 使用者這次考試的答題內容
    //選擇考場的界線
function list() {
    switchPanel('panelList');
    $.ajax({
    type: "GET",
    url: "/list",
    timeout: this.timeout,
    data: {}
    })
    .done(function(data) {
    exams = JSON.parse(data);
    $('#panelList').empty();
    $('#panelList').append("<h1>考場選擇<h1>");
    $('#panelList').append("<button type='button' class='btn btn-default' onclick='historyShow()'>返回歷史紀錄</button>");
    //$('#panelList').append("<ol>");
    for (ei in exams) {
      //$('#panelList').append('<div class="jumbotron"><li><input type="button" onclick="time()"><a href="javascript:exam('+ei+')" onclick="time()">'+exams[ei].exam+"</a></input></li>");
      $('#panelList').append('<table class = "table table-hover"><tr><td class = "success" type = "button" ><a href = "javascript:exam('+ei+')">'+exams[ei].exam+"</a></td></tr></table>");
    }
    //$('#panelHistory').append("</div>");
    //$('#panelList').append("</ol>");
    });
	}
function result(){  //考試系統的答案檢查，考試結果的報表
    var correct = 0;
    var wrong = 0;
    var onescore;  //一題分數
		$('#panelResult').empty();
		$('#panelResult').append("<h1>報表</h1>");
    /*20151114 Add by 王勁詠*/
    $('#panelResult').append('<div class="table-responsive"><table class="table table-hover"><thead><tr><th>' + "題目" + '</th><th>' + "你的答案" + '</th><th>' + "答題結果" + '</th><th>' + "正確答案" + '</th></tr></thead><tbody><tr id = "resultNullContentTop"><td></td><td></td><td></td><td></td></tr></tbody>');
    $('#panelResult').find('#resultNullContentTop').css('background-color','#6E7273');
    for( i = 0 ; i < exams[ei].qaList.length ; i++)
    {
      if(exams[ei].qaList[i].userAnswer == exams[ei].qaList[i].corrAns)
            {
              correct++;
              $('#panelResult').find('tbody:last').after('<tbody><tr><td><button type="button" class="btn btn-default" onclick="showQuestion('+i+')">看本題考題</button></td><td>' + exams[ei].qaList[i].userAnswer + '</td><td>' + "Correct" + '</td></tr></tbody>');
              //$('#panelHistoryreport').after('<td>' + his[ra].report.qaList[i].userAnswer + '</td>');
              //$('#panelHistoryreport').after('<td>' + "Correct" + '</td></tr></tbody>');
            }else{
              wrong++;
              $('#panelResult').find('tbody:last').after('<tbody><tr><td><button type="button" class="btn btn-default" onclick="showQuestion('+i+')">看本題考題</button></td><td>' + exams[ei].qaList[i].userAnswer + '</td><td>' + "Wrong" + '</td><td>'+ exams[ei].qaList[i].corrAns + '</td></tr></tbody>');
              //$('#panelHistoryreport').find('tbody:last').after('<td>' + his[ra].report.qaList[i].userAnswer + '</td>');
              //$('#panelHistoryreport').find('tbody:last').after('<td>' + "Wrong" + '</td>');
              //$('#panelHistoryreport').find('tbody:last').after('<td>'+ his[ra].report.qaList[i].corrAns + '</td></tr></tbody>');
            }
        if (i ==  exams[ei].qaList.length - 1)
        {
          $('#panelResult').find('tbody:last').after('<tbody><tr id = "resultNullContentBottom"><td></td><td></td><td></td><td></td></tr></tbody>');
          $('#panelResult').find('#resultNullContentBottom').css('background-color','#6E7273');
        }
    }
          $('#panelResult').append('</tr></tbody>');
          $('#panelResult').append('</table>');
          $('#panelResult').append('</div>');
/*
          if(correct+wrong == his[ra].report.qaList.length)
            {
              onescore = 100/his[ra].report.qaList.length;
              $('#panelResult').append("你答對"+correct+"題,答錯"+wrong+"題,總分："+correct*onescore+"分").css("font-size", "16pt");
            }
          $('#panelResult').append("<br/>");
          $('#panelResult').append("<button type='button' class='btn btn-default' onclick='historyShow()'>返回歷史紀錄</button>");
*/
    /*20151104 Add by 王勁詠 1114 修改邏輯
    for(  i = 0 ; i < exams[ei].qaList.length ; i++)
    {
        if(exams[ei].qaList[i].userAnswer == exams[ei].qaList[i].corrAns)
        {
          $('#panelResult').append("<li>你的答案："+exams[ei].qaList[i].userAnswer+"; 答題結果：你答對了！</li>");
          correct++;
          $('#panelResult').append('<button type="button" class="btn btn-default" onclick="showQuestion('+i+')">看本題考題</button>');
        }
        else {
          $('#panelResult').append("<li>你的答案："+exams[ei].qaList[i].userAnswer+"; 答題結果：你答錯了！, 正確答案："+exams[ei].qaList[i].corrAns+"</li>");
          wrong++;
          $('#panelResult').append('<button type="button" class="btn btn-default" onclick="showQuestion('+i+')">看本題考題</button>');
        }
        $('#panelResult').append("</ol>");
        $('#panelResult').append("</br>");
    }
    */
    if(correct+wrong == exams[ei].qaList.length)
    {
       onescore = 100/exams[ei].qaList.length;
       $('#panelResult').append("你答對"+correct+"題,答錯"+wrong+"題,總分："+correct*onescore+"分").css("font-size", "16pt");
       if(correct*onescore == 0)
          alertify.alert("看的到這個提示訊息代表...  你連一題都沒答對，0分。");
        else if (correct*onescore == 100) {
          alertify.alert("全對，拿了100分好棒棒");
        }
    }
    $('#panelResult').append("<br/>")
    $('#panelResult').append("<button type='button' class='btn btn-default' onclick='report()'>送出報表</button>");
    $('#panelResult').append("<button type='button' class='btn btn-default' onclick='list()'>重新考試</button>");
      /*20151104 Add by 王勁詠  原本邏輯
    for(i =0; i<exams[ei].qaList.length; i++)
        {
            if(exams[ei].qaList[i].userAnswer == exams[ei].qaList[i].a)
                {
                    $('#panelResult').append("<li>你的答案："+exams[ei].qaList[i].userAnswer+"; 答題結果：你答對了！</li>");
                    correct++;
					$('#panelResult').append('<button type="button" class="btn btn-default" onclick="showQuestion('+i+')">看本題考題</button>');
                }else{
                    $('#panelResult').append("<li>你的答案："+exams[ei].qaList[i].userAnswer+"; 答題結果：你答錯了！, 正確答案："+exams[ei].qaList[i].a+"</li>");
                    wrong++;
					$('#panelResult').append('<button type="button" class="btn btn-default" onclick="showQuestion('+i+')">看本題考題</button>');
                }
        }
        $('#panelResult').append("</ol>");
		    $('#panelResult').append("</br>");
        if(correct+wrong == exams[ei].qaList.length)
        {
           onescore = 100/exams[ei].qaList.length;
           $('#panelResult').append("你答對"+correct+"題,答錯"+wrong+"題,總分："+correct*onescore+"分");
        }
		$('#panelResult').append("<br/>")
		$('#panelResult').append("<button type='button' class='btn btn-default' onclick='report()'>送出報表</button>");
		$('#panelResult').append("<button type='button' class='btn btn-default' onclick='list()'>重新考試</button>");
    */
    }
	//這是管理者
	function check()
	 {
	   var jText = $('#jsonText').val();
	   var jobj = JSON.parse(jText);
       if (typeof jobj === undefined)
        alertify.alert("Error");
	   else
	       alertify.alert("Correct");
	   console.log("jobj="+JSON.stringify(jobj));
	 }
	 function send()
	 {
	   var jText = $('#jsonText').val();
	   var jobj =  JSON.parse(jText);
       var jText2 = $('#examName').val();
	   var jobj2 = jText2;
       //var jFile = $('#exampleInputFile').val();
       //var jobj3 =  jFile;
	   $.ajax({
       type: "POST",
       url: "/db/main/file",
       timeout: this.timeout,
       data: { obj:JSON.stringify(jobj) , obj2:JSON.stringify(jobj2)},  //變成字串
       })
      .done(function(data) {
      alertify.alert("送出成功");
      })
      .fail(function() {
       alertify.alert("送出失敗");
     });
	 }
	//登入
	var Message;
	function login() {
    $.ajax({
    type: "POST",
    url: "/password",
    timeout: 800000,
    data: {user:$('#loginUser').val(), password:$('#loginPassword').val() },
    })
    .done(function(data) {
	  var user = JSON.parse(data);
      //alert("user="+data);
	  if (user.type === "student")
	  {
	    localStorage.wd_login = "true";
    alertify.alert("學生登入成功");
		history();
        $('#panelUser').append($('#loginUser').val());
		$('#panelLogout').append("登出");
	  }else if(user.type === "teacher"){
        localStorage.wd_login = "true";
        alertify.alert("導師登入成功");
        switchPanel('panelEdit');
        $('#panelUser').append($('#loginUser').val());
        $('#panelLogout').append("登出");
      }
//	  Message = data;
//	  alert("Message="+Message);
/*
	  if(Message == "學生登入成功")
	  {
	    localStorage.wd_login = "true";
        alert( "學生登入成功!");
	    list();
	  }else if(Message == "導師登入成功"){
	    localStorage.wd_login = "true";
        alert( "導師登入成功!");
	    switchPanel('panelEdit');
	  }
	  else
	    alert("fail!");
*/
      })
      .fail(function() {
	   localStorage.wd_login = "false";
     alertify.alert("登入失敗");
	   switchPanel('panelHome');
     });
	}
	function logout() {
      $.ajax({
      type: "POST",
      url: "/logout",
      timeout: this.timeout,
      data: {},
    })
    .done(function(data) {
      localStorage.wd_login = "false";
      alertify.alert("登出成功");
	  loginUser.value = "";
	  loginPassword.value = "";
    ExamOverTime(0);
	  $('#panelUser').empty();
	  $('#panelLogout').empty();
	  /*
	  for(i =0; i<exams[0].qaList.length; i++)
	  {
	  exams[0].qaList[i].userAnswer = "";
	  }
	  */
      switchPanel('panelHome');
    })
    .fail(function() {
      alertify.alert("登出失敗");
     });
    }
	function report(){
	  var userInput = $('#loginUser').val();
	  var rt = exams[ei];
	  $.ajax({
      type: "POST",
      url: "/report",
      timeout: 800000,
	  data: {ui : userInput , report : rt},
	})
	.done(function(data) {
    alertify.alert("報表送出成功");
	 })
	.fail(function() {
      alertify.alert("報表送出失敗");
     });
	}
	var his;
	var ra;
function show(reportAmount){
    ra = reportAmount;
    switchPanel('panelHistoryreport');
    $('#panelHistoryreport').empty();
    $('#panelHistoryreport').append("<h1>歷史報表</h1>");
	  var correct = 0;
    var wrong = 0;
    /*20151113 Add by 王勁詠*/
    $('#panelHistoryreport').append('<div class="table-responsive"><table class="table table-hover"><thead><tr><th>' + "題目" + '</th><th>' + "你的答案" + '</th><th>' + "答題結果" + '</th><th>' + "正確答案" + '</th></tr></thead><tbody><tr id = "nullContentTop"><td></td><td></td><td></td><td></td></tr></tbody>');
    $('#panelHistoryreport').find('#nullContentTop').css('background-color','#6E7273');
    /*
    $('#panelHistoryreport').append('<table class="table table-hover">');
    $('#panelHistoryreport').append('<div class="table-responsive">');
    $('#panelHistoryreport').append('<table class="table table-hover">');
    $('#panelHistoryreport').append('<theah><tr>');
    $('#panelHistoryreport').append('<th>' + "題目" + '</th>');
    $('#panelHistoryreport').append('<th>' + "你的答案" + '</th>');
    $('#panelHistoryreport').append('<th>' + "答題結果" + '</th>');
    $('#panelHistoryreport').append('<th>' + "正確答案" + '</th>');
    $('#panelHistoryreport').append('</tr></theah>');
    $('#panelHistoryreport').append('<tbody><tr>');
    */
    for( i = 0 ; i <his[ra].report.qaList.length; i++ )
    {
      if(his[ra].report.qaList[i].userAnswer == his[ra].report.qaList[i].corrAns)
            {
              correct++;
              $('#panelHistoryreport').find('tbody:last').after('<tbody><tr><td><button type="button" class="btn btn-default" onclick="showHistoryquestion('+i+')">看本題考題</button></td><td>' + his[ra].report.qaList[i].userAnswer + '</td><td>' + "Correct" + '</td></tr></tbody>');
              //$('#panelHistoryreport').after('<td>' + his[ra].report.qaList[i].userAnswer + '</td>');
              //$('#panelHistoryreport').after('<td>' + "Correct" + '</td></tr></tbody>');
            }else{
              wrong++;
              $('#panelHistoryreport').find('tbody:last').after('<tbody><tr><td><button type="button" class="btn btn-default" onclick="showHistoryquestion('+i+')">看本題考題</button></td><td>' + his[ra].report.qaList[i].userAnswer + '</td><td>' + "Wrong" + '</td><td>'+ his[ra].report.qaList[i].corrAns + '</td></tr></tbody>');
              //$('#panelHistoryreport').find('tbody:last').after('<td>' + his[ra].report.qaList[i].userAnswer + '</td>');
              //$('#panelHistoryreport').find('tbody:last').after('<td>' + "Wrong" + '</td>');
              //$('#panelHistoryreport').find('tbody:last').after('<td>'+ his[ra].report.qaList[i].corrAns + '</td></tr></tbody>');
            }
        if (i == his[ra].report.qaList.length - 1)
        {
          $('#panelHistoryreport').find('tbody:last').after('<tbody><tr id = "nullContentBottom"><td></td><td></td><td></td><td></td></tr></tbody>');
          $('#panelHistoryreport').find('#nullContentBottom').css('background-color','#6E7273');
        }
    }
    $('#panelHistoryreport').append('</tr></tbody>');
    $('#panelHistoryreport').append('</table>');
    $('#panelHistoryreport').append('</div>');
    if(correct+wrong == his[ra].report.qaList.length)
      {
        onescore = 100/his[ra].report.qaList.length;
        $('#panelHistoryreport').append("你答對"+correct+"題,答錯"+wrong+"題,總分："+correct*onescore+"分").css("font-size", "16pt");
      }
    $('#panelHistoryreport').append("<br/>");
    $('#panelHistoryreport').append("<button type='button' class='btn btn-default' onclick='historyShow()'>返回歷史紀錄</button>");
/*
    for(i = 0 ; i<his[ra].report.qaList.length; i++)
      {
        if(his[ra].report.qaList[i].userAnswer == his[ra].report.qaList[i].corrAns)
        {
          $('#panelHistoryreport').append("<li>你的答案："+his[ra].report.qaList[i].userAnswer+"; 答題結果：你答對了！</li>");
          correct++;
          $('#panelHistoryreport').append('<button type="button" class="btn btn-default" onclick="showHistoryquestion('+i+')">看本題考題</button>');
        }else {
          $('#panelHistoryreport').append("<li>你的答案："+his[ra].report.qaList[i].userAnswer+"; 答題結果：你答錯了！, 正確答案："+his[ra].report.qaList[i].corrAns+"</li>");
          wrong++;
          $('#panelHistoryreport').append('<button type="button" class="btn btn-default" onclick="showHistoryquestion('+i+')">看本題考題</button>');
        }
      }
    if(correct+wrong == his[ra].report.qaList.length)
      {
        onescore = 100/his[ra].report.qaList.length;
        $('#panelHistoryreport').append("你答對"+correct+"題,答錯"+wrong+"題,總分："+correct*onescore+"分");
      }
    $('#panelHistoryreport').append("<br/>");
    $('#panelHistoryreport').append("<button type='button' class='btn btn-default' onclick='historyShow()'>返回歷史紀錄</button>");
*/
  }
	function historyShow(){
	  switchPanel('panelHistory');
	  $('#panelHistory').empty();
	  $('#panelHistory').append("<h1>歷史紀錄</h1>");
    $('#panelHistory').append("<button type='button' class='btn btn-default' onclick='list()'>開始考試</button>");
	  $('#panelHistory').append("<button type='button' class='btn btn-default' onclick='toMeg()'>開始搶答</button>");
    for(var i in his){
      //$('#panelHistory').append('<div class="jumbotron"><p class="lead"><li><a href="javascript:show('+i+')">'+his[i].report.exam+"</a></li></p>");
      $('#panelHistory').append('<table class = "table table-hover"><tr><td class = "warning" type = "button" ><a href = "javascript:show('+i+')">'+his[i].report.exam+"</a></td></tr></table>");
     }
    //$('#panelHistory').append("</div>");
	}
	function history(){
	  var userhistory = $('#loginUser').val();
	  $.ajax({
      type: "POST",
      url: "/history",
      timeout: 800000,
	  data: {userhistory : userhistory},
	})
	.done(function(data) {
    alertify.alert("收到歷史成績");
	  his = JSON.parse(data);
	  historyShow();
	  })
	  .fail(function() {
      alertify.alert("沒有收到歷史成績");
     });
	}
	function register(){
	  var registerUser = $('#registerUser').val();
	  var registerPassword = $('#registerPassword').val();
	  var registerJob = $('#registerJob').val();
	  $.ajax({
      type: "POST",
      url: "/register",
      timeout: 800000,
	  data: {registerUser : registerUser , registerPassword : registerPassword, registerJob : registerJob},
	})
	.done(function(data) {
    alertify.alert("註冊成功");
	  switchPanel('panelHome');
	  })
	  .fail(function() {
      alertify.alert("註冊失敗");
     });
	}
    function reset() {
	    exam();
    }
	function returnHome() {
	   switchPanel('panelHome');
	}
	function returnResult() {
	   switchPanel('panelResult');
	}
	function returnHistoryreport() {
	   switchPanel('panelHistoryreport');
	}
  /*After Exam sho your question*/
	function showQuestion(qai) {
	    var i = qai;
	    switchPanel('panelQuestion');
      $('#panelQuestion').empty();
      $('#panelQuestion').append("<h1>題目</h1>");
      $('#panelQuestion').append("題目："+exams[ei].qaList[i].q).css("font-size", "16pt");
      /*20151104 Add by 王勁詠*/
      $('#panelQuestion').append("<p>A:" + exams[ei].qaList[i].optionA + "</p>").css("font-size", "16pt");
      $('#panelQuestion').append("<p>B:" + exams[ei].qaList[i].optionB + "</p>").css("font-size", "16pt");
      $('#panelQuestion').append("<p>C:" + exams[ei].qaList[i].optionC+ "</p>").css("font-size", "16pt");
      $('#panelQuestion').append("<p>D:" + exams[ei].qaList[i].optionD + "</p>").css("font-size", "16pt");
      $('#panelQuestion').append('<button type="button" class="btn btn-default" onclick="returnResult()">返回報表</button>');
}
	function showHistoryquestion(hqai){
	    var i = hqai;
	    switchPanel('panelHistoryquestion');
      $('#panelHistoryquestion').empty();
      $('#panelHistoryquestion').append("<h1>歷史題目</h1>");
      /*20151104 Add by 王勁詠*/
      $('#panelHistoryquestion').append("題目："+his[ra].report.qaList[i].q).css("font-size", "16pt");
      $('#panelHistoryquestion').append("<p>A:" + his[ra].report.qaList[i].optionA + "</p>").css("font-size", "16pt");
      $('#panelHistoryquestion').append("<p>B:" + his[ra].report.qaList[i].optionB + "</p>").css("font-size", "16pt");
      $('#panelHistoryquestion').append("<p>C:" + his[ra].report.qaList[i].optionC+ "</p>").css("font-size", "16pt");
      $('#panelHistoryquestion').append("<p>D:" + his[ra].report.qaList[i].optionD + "</p>").css("font-size", "16pt");
      $('#panelHistoryquestion').append('<button type="button" class="btn btn-default" onclick="returnHistoryreport()">返回歷史報表</button>');
	}
	function nextPage(){
	    switchPanel('panelResult');
		result();
	}
	var t;
	function time()
  {
    //t=setTimeout("nextPage()",10000);
    /*
    switchPanel("panelExam");
  	$('#panelExam').empty();
  	$('#panelExam').append("<div class='page-header'>");
  	$('#panelExam').append("<h1>開始測驗 <span style='color:#336699' id='countMsg'></span></h1>");
  	$('#panelExam').append("</div>");
  	$('#panelExam').append(" 答案： <input id='editTitle' type='text' value=''>");
  	$('#panelExam').append("<p class='lead'>");
  	$('#panelExam').append("<form action='javascript:pass()' class='lead'>");
  	$('#panelExam').append("<span id='editBody'></span>");
  	$('#panelExam').append("</form>");
  	$('#panelExam').append("</p>");
    $('#panelExam').append("<input type='button' value='送出答案' onclick='pass()' class='btn btn-danger'>");
    $('#panelExam').append("<br/>");
    */
    /*
    $('#panelExam').append("<h1 class='alt-1'>00:00:10</h1>");
    */
    }
function toMeg(){
	   switchPanel("panelMessage");
	}
	var socket = io();
      $('form').submit(function(){
	    var message = $('#loginUser').val()+":"+$('#m').val();
        socket.emit('chat message', message);
        $('#m').val('');
        return false;
      });
      socket.on('chat message', function(msg){
        $('#messages').append($('<li>').text(msg));
    });
    </script>
	  <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript" src="js/jquery-2.1.1.js"></script>
    <script src="js/jquery.min.js"></script>
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>-->
    <script src="js/bootstrap.min.js"></script>
    <script src="js/collapse.js"></script>
    <script src="js/carousel.js"></script>

    <script type="text/javascript" src="js/jquery.countdown.min.js"></script>

    <link rel="stylesheet" href="css/countdown.demo.css">
    <!--20151107 Add by王勁詠 clock-->
    <script>
      //var dbTime = new Date().getTime() + 36000 exams[ei].time;
      /*
      var dbTime = new Date().getTime() + 36000;
      $('#clock').countdown(dbTime,{elapse: true})
      .on('update.countdown',function (event) {
        var $this  =  $(this);
        if(event.elapsed){
          $this.html(event.strftime('After end: <span>%H:%M:%S</span>'));
        }
        else {
          $this.html(event.strftime('To end: <span>%H:%M:%S</span>'));
        }
      });
      */
    </script>
	  <script src="js/bootstrap-filestyle.min.js"></script>
</body>

</html>
